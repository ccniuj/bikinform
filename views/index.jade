extends layout

block content
  style.
    body {
    background-color: #FFFFFF;
    }
    #test .arc2 {
    stroke-weight:0.1;
    fill: #3660b0;
    }
    #outer {
    background:#FFFFFF;
    border-radius: 5px;
    color: #000;
    }
    #div1, #div2, #div3, #div4 {
    width: 33%;
    height: 200px;
    box-sizing: border-box;
    float: left;
    }
    #div2 .arc {
    stroke-weight: 0.1;
    fill: #f0a417;
    }
    #div2 .arc2 {
    stroke-weight: 0.1;
    fill: #b00d08;
    }
    #div3 .arc {
    stroke-weight: 0.1;
    fill: #1d871b;
    }
    .selectedRadial {
    border-radius: 3px;
    background: #f4f4f4;
    color: #000;
    box-shadow: 0 1px 5px rgba(0,0,0,0.4);
    -moz-box-shadow: 0 1px 5px rgba(0,0,0,0.4);
    border: 1px solid rgba(200,200,200,0.85);
    }
    .radial {
    border-radius: 3px;
    background: #FFFFFF;
    color: #000;
    }
  .content-wrapper
    .container
      // Content Header (Page header)
      section.content-header
        //- h1 Youbike租借活躍指數
        //- ol.breadcrumb
        //-   li
        //-     a(href='#')
        //-       i.fa.fa-dashboard
        //-       |  Home
        //-   li
        //-     a(href='#') Layout
        //-   li.active Top Navigation
      section.content
        .box.box-primary
          .box-header.with-border
            h3.box-title Youbike租借活躍指數
          .box-body
            #map(style="width:100%;height:500px;")
            #db
            #outer(style='margin-top:40px; padding:10px')
              #main(style='width:600px; height:200px; margin: 0px auto; ')
                #div1
                #div2
                #div3
  script(src="/socket.io/socket.io.js")
  script(src="http://code.jquery.com/jquery-1.11.1.js")
  script(src="https://maps.googleapis.com/maps/api/js")
  script(type='text/javascript').
    var map;
    var markers = [];
    var diffs = [];
    function initMap() {
      map = new google.maps.Map(document.getElementById('map'), {
        center: {lat: 25.06, lng: 121.55},
        zoom: 13
      });
      //- var infoWindow = new google.maps.InfoWindow({map: map});

      // Try HTML5 geolocation.
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
          var pos = {
            lat: position.coords.latitude,
            lng: position.coords.longitude
          };
          
          //- infoWindow.setPosition(pos);
          //- infoWindow.setContent('Location found.');
          
          //- map.setCenter(pos);
        }, function() {
          handleLocationError(true, infoWindow, map.getCenter());
        });
      } else {
        // Browser doesn't support Geolocation
        handleLocationError(false, infoWindow, map.getCenter());
      }
    }
    function handleLocationError(browserHasGeolocation, infoWindow, pos) {
      infoWindow.setPosition(pos);
      infoWindow.setContent(browserHasGeolocation ?
                            'Error: The Geolocation service failed.' :
                            'Error: Your browser doesn\'t support geolocation.');
    }
    function marker(pos, map, icon_url) {
      var marker = new google.maps.Marker({
        position: pos,
        map: map,
        icon: icon_url,
        title: 'Hello World!'
      });
      markers.push(marker);
    }
    function remove_markers() {
      for (var i = 0; i < markers.length; i++) {
        markers[i].setMap(null);
      }
      markers = [];
    }
    var socket = io();
    //- $('form').submit(function(){
    //-   socket.emit('chat message', $('#m').val());
    //-   $('#m').val('');
    //-   return false;
    //- });
    socket.on('update data', function(data){
      remove_markers();
      console.log('update');
      diffs = [];
      data.forEach(function (d) {
        diffs.push(d.diff);
        var icon_url = '';
        if (d.diff > 4) {
          icon_url = '/images/5.png';
        } else if ((4 >= d.diff) && (d.diff > 2)) {
          icon_url = '/images/4.png';
        } else if (Math.abs(d.diff) <= 2) {
          icon_url = '/images/3.png';
        } else if ((-2 > d.diff) && (d.diff >= -4)) {
          icon_url = '/images/2.png';
        } else {
          icon_url = '/images/1.png';
        }
        marker(d.pos, map, icon_url);
      })
    });

    initMap();
  script(language='JavaScript').
    var div1=d3.select(document.getElementById('div1'));
    var div2=d3.select(document.getElementById('div2'));
    var div3=d3.select(document.getElementById('div3'));
    var div4=d3.select(document.getElementById('div4'));
    start();
    function onClick1() {
    deselect();
    div1.attr("class","selectedRadial");
    }
    function onClick2() {
    deselect();
    div2.attr("class","selectedRadial");
    }
    function onClick3() {
    deselect();
    div3.attr("class","selectedRadial");
    }
    function labelFunction(val,min,max) {
    }
    function deselect() {
    div1.attr("class","radial");
    div2.attr("class","radial");
    div3.attr("class","radial");
    }
    function start() {
    var rp1 = radialProgress(document.getElementById('div1'))
    .label("RADIAL 1")
    .onClick(onClick1)
    .diameter(150)
    .value(78)
    .render();
    var rp2 = radialProgress(document.getElementById('div2'))
    .label("RADIAL 2")
    .onClick(onClick2)
    .diameter(150)
    .value(132)
    .render();
    var rp3 = radialProgress(document.getElementById('div3'))
    .label("RADIAL 3")
    .onClick(onClick3)
    .diameter(150)
    .minValue(100)
    .maxValue(200)
    .value(150)
    .render();
    }