extends layout

block content
  .content-wrapper
    .container
      // Content Header (Page header)
      section.content-header
        //- h1 Youbike租借活躍指數
        //- ol.breadcrumb
        //-   li
        //-     a(href='#')
        //-       i.fa.fa-dashboard
        //-       |  Home
        //-   li
        //-     a(href='#') Layout
        //-   li.active Top Navigation
      section.content
        .box.box-primary
          .box-header.with-border
            h3.box-title Youbike租借活躍指數
          .box-body
            #map(style="width:100%;height:500px;")
            #db
              //- each v, k in data[0]['retVal']
              //-   each a, b in v
              //-     h6= b + ':' + a
              //-   hr
              each v, k in data
                h6= k
  script(src="/socket.io/socket.io.js")
  script(src="http://code.jquery.com/jquery-1.11.1.js")
  script(src="http://maps.googleapis.com/maps/api/js")
  script(type='text/javascript').
    var socket = io();
    //- $('form').submit(function(){
    //-   socket.emit('chat message', $('#m').val());
    //-   $('#m').val('');
    //-   return false;
    //- });
    socket.on('update data', function(msg){
      $('#db').append($('<h6>').text(msg.test));
    });
  script(type='text/javascript').
    function initMap() {
      var map = new google.maps.Map(document.getElementById('map'), {
        center: {lat: 25.06, lng: 121.55},
        zoom: 13
      });
      //- var infoWindow = new google.maps.InfoWindow({map: map});

      // Try HTML5 geolocation.
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
          var pos = {
            lat: position.coords.latitude,
            lng: position.coords.longitude
          };
          //- var marker = new google.maps.Marker({
          //-   position: pos,
          //-   map: map,
          //-   title: 'Hello World!'
          //- });
          //- infoWindow.setPosition(pos);
          //- infoWindow.setContent('Location found.');
          
          //- map.setCenter(pos);
        }, function() {
          handleLocationError(true, infoWindow, map.getCenter());
        });
      } else {
        // Browser doesn't support Geolocation
        handleLocationError(false, infoWindow, map.getCenter());
      }
    }
    function handleLocationError(browserHasGeolocation, infoWindow, pos) {
      infoWindow.setPosition(pos);
      infoWindow.setContent(browserHasGeolocation ?
                            'Error: The Geolocation service failed.' :
                            'Error: Your browser doesn\'t support geolocation.');
    }
    
    initMap();
